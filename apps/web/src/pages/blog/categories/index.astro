---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { SITE_URL } from "../../../lib/constants/config";

const allPosts = await getCollection("blog", ({ data }) => !data.draft);
const counts = new Map<string, number>();
for (const post of allPosts) {
  const key = String(post.data.category || "未分类");
  counts.set(key, (counts.get(key) || 0) + 1);
}

const categories = Array.from(counts.entries())
  .sort((a, b) => b[1] - a[1])
  .map(([name, count]) => ({ name, count }));
---

<BaseLayout
  title="博客分类 - PocketBase.cn"
  description="按分类浏览 PocketBase.cn 的博客文章。"
>
  <Fragment slot="head">
    <link
      rel="alternate"
      type="application/rss+xml"
      title="PocketBase.cn 博客"
      href={`${SITE_URL}/blog/rss.xml`}
    />
  </Fragment>

  <div class="mx-auto max-w-3xl">
    <h1 class="text-2xl font-semibold tracking-tight">博客分类</h1>
    <p class="mt-2 text-sm text-neutral-600 dark:text-neutral-400">
      按分类浏览 PocketBase 相关文章与教程。
    </p>

    <div class="mt-6 grid gap-3">
      {categories.map((cat) => (
        <a
          href={`/blog/category/${encodeURIComponent(cat.name)}/`}
          class="flex items-center justify-between rounded-xl border border-neutral-200 px-4 py-3 hover:border-neutral-300 dark:border-neutral-800 dark:hover:border-neutral-700"
        >
          <span class="font-medium">{cat.name}</span>
          <span class="text-sm text-neutral-500 dark:text-neutral-400">
            {cat.count} 篇
          </span>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>

